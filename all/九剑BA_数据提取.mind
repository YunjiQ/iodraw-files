{"root":{"data":{"id":"d7xy0eq3nhk0","created":1740122687390,"text":"数据提取"},"children":[{"data":{"id":"d7xy0q715540","created":1740122712358,"text":"WHAT 取什么"},"children":[{"data":{"id":"d7xy1hwzm6w0","created":1740122772701,"text":"确认数据口径"},"children":[{"data":{"id":"d7xy1nrwuuo0","created":1740122785454,"text":"业务->数据"},"children":[]},{"data":{"id":"d7xy1r4xfmo0","created":1740122792772,"text":"明确指标口径"},"children":[]}]},{"data":{"id":"d7xy1mhpq3k0","created":1740122782661,"text":"确定分析维度"},"children":[{"data":{"id":"d7xy1mj644o0","created":1740122782749,"text":"确定数据颗粒度"},"children":[]}]},{"data":{"id":"d7xy22d69ls0","created":1740122817215,"text":"写下全部字段"},"children":[{"data":{"id":"d7xy25s63pc0","created":1740122824652,"text":"全局意识"},"children":[]},{"data":{"id":"d7xy293z39c0","created":1740122831896,"text":"保留过程字段"},"children":[]}]},{"data":{"id":"d7xy2e2pfgg0","created":1740122842703,"text":"禁忌：没有全局概念，只跑结果不保留过程"},"children":[]}]},{"data":{"id":"d7xy0z2b3lc0","created":1740122731663,"text":"WHERE 在哪取","expandState":"expand"},"children":[{"data":{"id":"d7xy2vm26xk0","created":1740122880879,"text":"数据产品：优先考察是否有数据产品"},"children":[{"data":{"id":"d7xy3lcbb340","created":1740122936886,"text":"若无，则考虑大圣、天狼"},"children":[]}]},{"data":{"id":"d7xy3wb7m0w0","created":1740122960764,"text":"数据仓库"},"children":[{"data":{"id":"d7xy437kcrk0","created":1740122975781,"text":"数据表选择：满足数据需求前提下，优先选择主题表（数据量级小）的表"},"children":[{"data":{"id":"d7xy58lfwm00","created":1740123065868,"text":"大禹"},"children":[]}]}]},{"data":{"id":"d7xy67lucy80","created":1740123142080,"text":"数据源"},"children":[{"data":{"id":"d7xy9gu314g0","created":1740123397261,"text":"数据源选择","expandState":"expand"},"children":[{"data":{"id":"d7xy7gwjulc0","created":1740123240682,"text":"量级小时，选Presto（稳定性低、速度快；除法默认为整型结果，应写为 select 1.0/2）"},"children":[]},{"data":{"id":"d7xy7lakfg80","created":1740123250237,"text":"量极大时，优先选OneSQL（稳定性高、速度快、占用资源高、语法少），而后是Hive（稳定性高、占用资源少、速度慢）"},"children":[]}]},{"data":{"id":"d7xy9j4ae9k0","created":1740123402232,"text":"数据源检查"},"children":[{"data":{"id":"d7xy9xrewp40","created":1740123434105,"text":"熟悉数据表"},"children":[{"data":{"id":"d7xyaejag3s0","created":1740123470619,"text":"了解产品"},"children":[{"data":{"id":"d7xyb2a428o0","created":1740123522307,"text":"例：意向UV：POI详情页、产品房型中间页、deal中间页、deal详情页"},"children":[]}]},{"data":{"id":"d7xyat8lmw00","created":1740123502625,"text":"了解数据表（数据落标口径及生产机制）"},"children":[{"data":{"id":"d7xybeqd3200","created":1740123549411,"text":"最小颗粒度 例：\nPOI信息表：只到POI维度\nPOI历史信息表：天+POI维度"},"children":[]}]}]},{"data":{"id":"d7xyarlldnc0","created":1740123499057,"text":"检查数据质量"},"children":[{"data":{"id":"d7xyfvho0wo0","created":1740123899347,"text":"数据是否完整","expandState":"expand"},"children":[{"data":{"id":"d7xycgpvo880","created":1740123632100,"text":"数据完整性检查"},"children":[{"data":{"id":"d7xyd20kpb40","created":1740123678459,"text":"方法：根据不同分析场景、拆分不同分析维度、检查每个维度数据是否完整"},"children":[]},{"data":{"id":"d7xydqpk6sg0","created":1740123732212,"text":"例如：\n商家分析：城市、战区、星级\n用户分析：用户生命周期\n趋势分析：小时、天、周、月"},"children":[]}]},{"data":{"id":"d7xyd87oh1c0","created":1740123691949,"text":"数据完整性清洗"},"children":[{"data":{"id":"d7xye9em4m00","created":1740123772909,"text":"1、上游表是否有数据"},"children":[]},{"data":{"id":"d7xyehqzm080","created":1740123791072,"text":"2、是否使用标准表"},"children":[]},{"data":{"id":"d7xyemf0c5k0","created":1740123801231,"text":"3、缺失值处理"},"children":[{"data":{"id":"d7xyeqirpfc0","created":1740123810166,"text":"手动填充"},"children":[]},{"data":{"id":"d7xyesz8bjs0","created":1740123815515,"text":"删除记录"},"children":[]},{"data":{"id":"d7xyetvviyw0","created":1740123817489,"text":"规则填充"},"children":[]}]}]}]},{"data":{"id":"d7xyfrh0v5c0","created":1740123890601,"text":"数据是否准确"},"children":[{"data":{"id":"d7xyfzmr8tc0","created":1740123908362,"text":"数据准确性检查"},"children":[{"data":{"id":"d7xyg6rhmnk0","created":1740123923886,"text":"是否和已知准确表一直、是否符合业务尝试、是否在合理范围"},"children":[]}]},{"data":{"id":"d7xyg2juvhs0","created":1740123914717,"text":"数据准确性清洗"},"children":[{"data":{"id":"d7xygeimgrk0","created":1740123940764,"text":"1、是否使用标准表"},"children":[]},{"data":{"id":"d7xygl8x3zc0","created":1740123955415,"text":"2、SQL逻辑是否写错"},"children":[]},{"data":{"id":"d7xygo8bi600","created":1740123961909,"text":"3、SQL逻辑修正"},"children":[{"data":{"id":"d7xygt0y1cw0","created":1740123972347,"text":"数据口径"},"children":[]},{"data":{"id":"d7xygv4gwhk0","created":1740123976913,"text":"限制条件"},"children":[]},{"data":{"id":"d7xygwuq8io0","created":1740123980678,"text":"字段类型"},"children":[]}]}]}]},{"data":{"id":"d7xyi9ryvvk0","created":1740124087174,"text":"数据是否唯一"},"children":[{"data":{"id":"d7xyienj7w80","created":1740124097789,"text":"数据唯一性检查"},"children":[{"data":{"id":"d7xyiseu8sw0","created":1740124127739,"text":"明细数据是否重复、数据量是否异常大"},"children":[]}]},{"data":{"id":"d7xyiitce400","created":1740124106848,"text":"数据唯一性清洗"},"children":[{"data":{"id":"d7xyim05r2w0","created":1740124113790,"text":"字段是否全部一致"},"children":[]},{"data":{"id":"d7xyiopcemw0","created":1740124119667,"text":"底层数据是否重复"},"children":[]}]}]}]}]}]}]},{"data":{"id":"d7xy11c40uw0","created":1740122736610,"text":"HOW 怎么取"},"children":[{"data":{"id":"d7xyjd62g000","created":1740124172921,"text":"SQL书写习惯"},"children":[{"data":{"id":"d7xyjp0sefk0","created":1740124198723,"text":"编辑器推荐：Sublime； Python开发平台：MTJupyter"},"children":[]},{"data":{"id":"d7xyl5c90co0","created":1740124312608,"text":"保留准确的SQL、尽量不要抢资源（凌晨时段数据库调度）、注释、排版"},"children":[]}]},{"data":{"id":"d7xylfh5kco0","created":1740124334673,"text":"SQL方法"},"children":[{"data":{"id":"d7xyls0go0o0","created":1740124361962,"text":"json数据预处理"},"children":[{"data":{"id":"d7xym4m26kg0","created":1740124389389,"text":"原则：优先让数仓RD处理"},"children":[]},{"data":{"id":"d7xym9kt28w0","created":1740124400197,"text":"解析语法：get_json_object(string json_string, string path)"},"children":[]}]},{"data":{"id":"d7xymt36i8w0","created":1740124442667,"text":"常用SQL语法函数"},"children":[{"data":{"id":"d7xyn01mm1s0","created":1740124457811,"text":"日期变量"},"children":[{"data":{"id":"d7xyn5auwa80","created":1740124469253,"text":"用户自定义：$$begindate $$enddate 格式为2016-11-28（字符型）"},"children":[]},{"data":{"id":"d7xynqazhx40","created":1740124514973,"text":"系统预置：$$weekfirst_compact 自动取本周一的日期，格式为20170717（整型）"},"children":[]}]},{"data":{"id":"d7xyogne35c0","created":1740124572319,"text":"日期变量偏移"},"children":[{"data":{"id":"d7xyom132sg0","created":1740124584031,"text":"使用方式：在系统预置日期变量后面添加{偏移量}"},"children":[]},{"data":{"id":"d7xyp9r7fw80","created":1740124635677,"text":"例：$$begindatekey{-1w, 1d} （可以组合便宜，先向前偏移1周，再向后偏移1天）"},"children":[]}]},{"data":{"id":"d7xyq5wm8s00","created":1740124705661,"text":"日期处理"},"children":[{"data":{"id":"d7xyq7hcrt40","created":1740124709091,"text":"取星期几：select mod(datediff(datekey2date(datekey), '1920-01-01')-3, 7)  输出结果为0-6的数，分别代表日，一，...，二"},"children":[]},{"data":{"id":"d7xyrndaquo0","created":1740124822039,"text":"取时间偏移：select from_unixtime(unix_timestamp(order_time)+60*60*2) 下单后两小时对应时间"},"children":[]}]},{"data":{"id":"d7xysi2teeg0","created":1740124888885,"text":"常用窗口函数"},"children":[{"data":{"id":"d7xysodqpwg0","created":1740124902607,"text":"分组排序：row_number() over(partition by province_name order by roomnights desc) as nt"},"children":[]},{"data":{"id":"d7xysq7duy00","created":1740124906576,"text":"分组分布：ntile(4) over(partition by province_name order by roomnights desc) as nt"},"children":[]}]}]},{"data":{"id":"d7xytwlaye00","created":1740124998842,"text":"常见错误"},"children":[{"data":{"id":"d7xyu08dppc0","created":1740125006768,"text":"权限不足"},"children":[]},{"data":{"id":"d7xyu1sdpzk0","created":1740125010154,"text":"查询数据过多"},"children":[]},{"data":{"id":"d7xyu3ovhb40","created":1740125014296,"text":"分组字段缺失"},"children":[]}]}]},{"data":{"id":"d7xyunvi1ts0","created":1740125058232,"text":"SQL效率"},"children":[{"data":{"id":"d7xyvuosjeo0","created":1740125151428,"text":"Hive执行顺序"},"children":[{"data":{"id":"d7xywj6omhs0","created":1740125204753,"text":"FROM > ON > JOIN > WHERE > GROUP BY > HAVING > SELECT > DISTINCT > ORDER BY > LIMIT"},"children":[]}]},{"data":{"id":"d7xyyhu40ls0","created":1740125358544,"text":"避免数据倾斜"},"children":[{"data":{"id":"d7xyym5z5xc0","created":1740125367969,"text":"原因"},"children":[{"data":{"id":"d7xyyogn9200","created":1740125372967,"text":"key分布不均匀：一个reducer处理数据量远大于其他"},"children":[{"data":{"id":"d7xyzpymajk0","created":1740125454595,"text":"解决方案：新建key值让数据分布更均匀"},"children":[]}]},{"data":{"id":"d7xyyrgg8zs0","created":1740125379486,"text":"关联字段数据类型不一致"},"children":[{"data":{"id":"d7xz1lpzbzk0","created":1740125602094,"text":"解决方案：显性转换字段类型"},"children":[]}]},{"data":{"id":"d7xyyuxhcl40","created":1740125387046,"text":"其他：业务数据本身的特性、建表时本身考虑步骤"},"children":[]}]}]},{"data":{"id":"d7xz2amq9so0","created":1740125656317,"text":"尽早过滤没用数据"},"children":[{"data":{"id":"d7xz2i1u0280","created":1740125672467,"text":"写过滤条件时，有主键一定要限制主键"},"children":[]}]},{"data":{"id":"d7xz30ct31k0","created":1740125712314,"text":"尽可能不用子查询"},"children":[{"data":{"id":"d7xz34i4hzc0","created":1740125721342,"text":"巧用left semi join"},"children":[]}]}]}]}]},"template":"right","theme":"fresh-blue","version":"1.4.43"}